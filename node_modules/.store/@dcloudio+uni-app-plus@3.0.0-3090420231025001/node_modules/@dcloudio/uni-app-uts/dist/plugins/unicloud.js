"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.uniCloudPlugin = void 0;
const utils_1 = require("./utils");
const uniCloudSpaceList = (0, utils_1.getUniCloudSpaceList)();
function uniCloudPlugin() {
    return {
        name: 'uni:app-unicloud',
        apply: 'build',
        generateBundle(_, bundle) {
            if (uniCloudSpaceList.length === 0) {
                return;
            }
            if (bundle[utils_1.ENTRY_FILENAME]) {
                const asset = bundle[utils_1.ENTRY_FILENAME];
                asset.source =
                    asset.source +
                        `
import "io.dcloud.unicloud.InternalUniCloudConfig"
export class UniCloudConfig extends InternalUniCloudConfig {
    override isDev : boolean = ${process.env.NODE_ENV === 'development' ? 'true' : 'false'}
    override spaceList : string = ${JSON.stringify(JSON.stringify(uniCloudSpaceList.map((item) => {
                            const itemCopy = { ...item };
                            delete itemCopy.workspaceFolder;
                            return itemCopy;
                        })))}
    override debuggerInfo ?: string = ${JSON.stringify(process.env.UNICLOUD_DEBUG || null)}
    override secureNetworkEnable : boolean = false
    override secureNetworkConfig ?: string = ""
    constructor() {}
}
`;
            }
        },
    };
}
exports.uniCloudPlugin = uniCloudPlugin;
